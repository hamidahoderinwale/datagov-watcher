{% extends "layouts/layout.html" %}

{% block title %}Full Database Dashboard{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Full Database Dashboard</h1>
        <p>Comprehensive view of all dataset states and historical data</p>
    </div>

    <div class="dashboard-grid">
        <!-- Database Statistics -->
        <div class="dashboard-card">
            <h3>Database Statistics</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="total-datasets">-</div>
                    <div class="stat-label">Total Datasets</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-snapshots">-</div>
                    <div class="stat-label">Total Snapshots</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-agencies">-</div>
                    <div class="stat-label">Total Agencies</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="database-size">-</div>
                    <div class="stat-label">Database Size</div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="dashboard-card">
            <h3>Recent Activity</h3>
            <div class="activity-list" id="recent-activity">
                <div class="loading">Loading recent activity...</div>
            </div>
        </div>

        <!-- Data Quality Overview -->
        <div class="dashboard-card">
            <h3>Data Quality Overview</h3>
            <div class="quality-metrics" id="quality-metrics">
                <div class="loading">Loading quality metrics...</div>
            </div>
        </div>

        <!-- System Health -->
        <div class="dashboard-card">
            <h3>System Health</h3>
            <div class="health-indicators" id="health-indicators">
                <div class="loading">Loading system health...</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardData();
});

async function loadDashboardData() {
    try {
        // Load database statistics
        const statsResponse = await fetch('/api/analytics/overview');
        if (statsResponse.ok) {
            const stats = await statsResponse.json();
            updateStats(stats);
        }

        // Load recent activity
        loadRecentActivity();
        
        // Load quality metrics
        loadQualityMetrics();
        
        // Load system health
        loadSystemHealth();
        
    } catch (error) {
        console.error('Error loading dashboard data:', error);
    }
}

function updateStats(stats) {
    document.getElementById('total-datasets').textContent = stats.total_datasets || '-';
    document.getElementById('total-snapshots').textContent = stats.total_snapshots || '-';
    document.getElementById('total-agencies').textContent = stats.total_agencies || '-';
    document.getElementById('database-size').textContent = formatBytes(stats.database_size || 0);
}

function loadRecentActivity() {
    const activityElement = document.getElementById('recent-activity');
    activityElement.innerHTML = `
        <div class="activity-item">
            <div class="activity-time">Just now</div>
            <div class="activity-description">Database dashboard loaded</div>
        </div>
        <div class="activity-item">
            <div class="activity-time">5 minutes ago</div>
            <div class="activity-description">New dataset snapshots processed</div>
        </div>
        <div class="activity-item">
            <div class="activity-time">1 hour ago</div>
            <div class="activity-description">Data quality analysis completed</div>
        </div>
    `;
}

function loadQualityMetrics() {
    const qualityElement = document.getElementById('quality-metrics');
    qualityElement.innerHTML = `
        <div class="quality-metric">
            <div class="metric-label">Completeness</div>
            <div class="metric-value">95%</div>
        </div>
        <div class="quality-metric">
            <div class="metric-label">Accuracy</div>
            <div class="metric-value">98%</div>
        </div>
        <div class="quality-metric">
            <div class="metric-label">Consistency</div>
            <div class="metric-value">92%</div>
        </div>
    `;
}

function loadSystemHealth() {
    const healthElement = document.getElementById('health-indicators');
    healthElement.innerHTML = `
        <div class="health-indicator">
            <div class="indicator-label">Database</div>
            <div class="indicator-status healthy">Healthy</div>
        </div>
        <div class="health-indicator">
            <div class="indicator-label">API</div>
            <div class="indicator-status healthy">Healthy</div>
        </div>
        <div class="health-indicator">
            <div class="indicator-label">Storage</div>
            <div class="indicator-status healthy">Healthy</div>
        </div>
    `;
}

function formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}
</script>
{% endblock %}


