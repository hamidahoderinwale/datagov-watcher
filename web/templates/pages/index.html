<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dataset State Historian</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <header class="header">
        <h1>Concordance: Dataset State Historian</h1>
        <p>Comprehensive monitoring and analysis of government datasets</p>
    </header>
    
    <div class="container">
        <div class="text-center mb-20">
            <h2>Welcome to the Dataset State Historian</h2>
            <p>A comprehensive system for monitoring and analyzing the evolution of government datasets</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalDatasets">-</div>
                <div class="stat-label">Total Datasets</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalSnapshots">-</div>
                <div class="stat-label">Total Snapshots</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalDiffs">-</div>
                <div class="stat-label">State Changes</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="availableDatasets">-</div>
                <div class="stat-label">Available</div>
            </div>
        </div>
        
        <div class="text-center mb-20">
            <a href="/dashboard" class="btn btn-primary">Go to Dashboard</a>
            <a href="/timeline" class="btn btn-primary">View Timeline</a>
            <a href="/data-viewer" class="btn btn-primary">Data Viewer</a>
        </div>
        
        <div class="data-viewer">
            <div class="data-viewer-header">
                <h3 class="data-viewer-title">System Status</h3>
                <span class="last-updated">Last updated: Loading...</span>
            </div>
            <div id="systemStatus" class="data-content">
                <div class="loading">Loading system status...</div>
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Load system status
        async function loadSystemStatus() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();
                
                document.getElementById('totalDatasets').textContent = stats.unique_datasets || 0;
                document.getElementById('totalSnapshots').textContent = stats.total_snapshots || 0;
                document.getElementById('totalDiffs').textContent = stats.total_diffs || 0;
                document.getElementById('availableDatasets').textContent = stats.availability_stats?.available || 0;
                
                document.getElementById('systemStatus').innerHTML = `
                    <div>
                        <p><strong>System Status:</strong> <span class="success">Operational</span></p>
                        <p><strong>Last Updated:</strong> ${stats.last_updated || 'N/A'}</p>
                        <p><strong>Database Records:</strong> ${stats.total_snapshots || 0} snapshots</p>
                        <p><strong>Available Datasets:</strong> ${stats.availability_stats?.available || 0}</p>
                        <p><strong>Unavailable Datasets:</strong> ${stats.availability_stats?.unavailable || 0}</p>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading system status:', error);
                document.getElementById('systemStatus').innerHTML = '<div class="error">Error loading system status</div>';
            }
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemStatus();
        });
    </script>
</body>
</html>
